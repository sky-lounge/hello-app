blueprint-uri: sky-lounge/skylounge-definitions/blueprints/cloud-run-web-app/blueprint.yml

workflows:
  - workflow: development
    jobs:
      - job: build
        steps:
          - step: build-container-image
            template-uri: sky-lounge/skylounge-definitions/step-templates/pack/nginx/build-steps.yml

      - job: load-balancer
        params:
          dns_zone_name: # skyloungedev # The name of the DNS zone in Google DNS in which to register the development application route.
          gcp_project_id: # sky-lounge-director # The Google Cloud project Id for development
          gcp_region: # us-central1 # The Google Cloud project region for development
          tf_state_bucket: # skylounge-tfstate.rscale.io # The Google Cloud Storage bucket in which to store Terraform state for development

      - job: integration-test
        template-uri: sky-lounge/skylounge-hello-world/skylounge/jobs/integration-test.yml

    params:
      app_route: # hello-world.skylounge.dev # The route to use for the application in development.
      build_paths: ["public/**", "nginx.conf"]

  - workflow: production
    jobs:
      - job: load-balancer
        params:
          dns_zone_name: # skyloungeio # The name of the DNS zone in Google DNS in which to register the production application route.
          gcp_project_id: # sky-lounge-director # The Google Cloud project Id for production
          gcp_region: # us-central1 # The Google Cloud project region for production
          tf_state_bucket: # skylounge-tfstate.rscale.io # The Google Cloud Storage bucket in which to store Terraform state for production

    params:
      app_route: # hello-world.skylounge.io # The route to use for the application in production.

params:
  registry_full_url: # us-west1-docker.pkg.dev # The full URL of the Google Artifact Registry to use for container image storage.
